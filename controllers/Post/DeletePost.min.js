const mysql=require("mysql");const MysqlData=require("../../models/MysqlData");const connection=mysql.createConnection((new MysqlData).getConnection());const escapeHtml=require("escape-html");const Aes256=require("../../lib/Aes256");const Sha512=require("../../lib/Sha512");const filterHtml=require("../../lib/filterHtml").filterHtml;module.exports=class{constructor(postId,userId,password){this.postId=postId;this.userId=userId;this.encryptedUserId=new Aes256(this.userId,"plain").getEncrypted();this.password=password;this.encryptedPassword=new Sha512(this.password).getEncrypted()}post(){return new Promise((resolve,reject)=>{connection.query("SELECT `id`\n"+"    FROM accounts\n"+"    WHERE `index`= (\n"+"        SELECT `author`\n"+"            FROM posts\n"+"            WHERE\n"+"                `index`=? AND\n"+"                `password`=?\n"+"    );",[this.postId,this.encryptedPassword],(error,accountResult,fields)=>{if(error){throw error}if(accountResult.length>0){if(accountResult[0].id===this.encryptedUserId){connection.query("DELETE\n"+"    FROM `posts`\n"+"    WHERE `index`=?;",[this.postId],(error,result,fields)=>{if(error){throw error}resolve()})}else{reject("invalid-user")}}else{reject("wrong-password")}})})}};
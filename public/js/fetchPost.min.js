const fetchPost=(postId,password)=>{fetch("https://community.bhsjp.kro.kr/get-post",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({postId:postId,password:password,needComments:true,increaseViews:true})}).then(res=>{return res.json()}).then(obj=>{switch(obj.result){case"right":postNickname.innerHTML=obj.data.nickname?obj.data.nickname:`<span><del>${messages.static.nonExistingUser}</del></span>`;postViews.innerText=obj.data.views;postDate.innerText=new Date(obj.data.date).toLocaleString();postContent.innerHTML=obj.data.content;if(obj.data.isModified){title.innerHTML+=`<span class="post-edited">${messages.static.edited}</span>`}for(let i of obj.data.comments){commentsContainer.innerHTML+=`\n                        <div class="comment-form">\n                            <div class="comments ${i.isPrivate?"private-comment":""}">\n                                <div>\n                                    ${i.nickname?i.nickname:`<span><del>${messages.static.nonExistingUser}</del></span>`}&#58;&nbsp;${new Date(i.date).toLocaleString()}${i.isModified?`&nbsp;(${messages.static.edited})`:""}\n                                </div>\n                                \n                                <div>\n                                    ${i.content}\n                                </div>\n                            </div>\n                            \n                            ${(()=>{switch(i.userPermission){case"writer":return`\n                                            <span class="configure-comment">\n                                                <button class="edit-comment" data-target="${i.index}">${messages.static.edit}</button>\n                                                <button class="delete-comment" data-target="${i.index}">${messages.static.delete}</button>\n                                            </span>\n                                        `;case"postOwner":return`\n                                            <span class="configure-comment">\n                                                <button class="delete-comment" data-target="${i.index}">${messages.static.delete}</button>\n                                            </span>\n                                        `;case"none":return``}})()}\n                        </div>\n                    `}for(const i of document.getElementsByClassName("edit-comment")){i.addEventListener("click",()=>{let root=i.parentElement.parentElement.firstElementChild;quill.clipboard.dangerouslyPasteHTML(root.getElementsByTagName("div")[1].innerHTML);isPrivateComment.checked=root.classList.contains("private-comment");updateTarget=i.dataset.target;newComment.style.display="none";updateComment.style.display="block";cancelUpdateComment.style.display="block"})}for(const i of document.getElementsByClassName("delete-comment")){i.addEventListener("click",()=>{vex.dialog.confirm({message:messages.confirm.deleteComment,callback:value=>{if(value){fetchDeleteComment(i.dataset.target)}}})})}break;case"wrong":vex.dialog.open({message:messages.request.inputPassword,input:`\n                        <input name="password" type="password">\n                    `,callback:data=>{if(data){fetchPost(postId,data.password)}else{history.back()}}});break;case"no-post":vex.dialog.alert({unsafeMessage:messages.error.noPost,callback:()=>{history.back()}});break;case"error":vex.dialog.alert({unsafeMessage:messages.error.server,callback:()=>{vex.dialog.open({message:messages.request.inputPassword,input:`\n                                <input name="password" type="password">\n                            `,callback:data=>{if(data){fetchPost(postId,data.password)}else{history.back()}}})}});break}}).catch(err=>{console.error(err);vex.dialog.alert({unsafeMessage:messages.error.cannotConnectServer})})};
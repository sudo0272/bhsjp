extends ../layout

block css
    link(href='/css/posts.min.css' rel='stylesheet')
    link(href='https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.min.css' rel='stylesheet')

block html
    #post-information.d-flex.flex-row.justify-content-around
        .d-flex.flex-row
            i.material-icons account_box
            span#post-nickname

        .d-flex.flex-row
            i.material-icons access_time
            span#post-date

    .separating-line

    #post-content

    .separating-line

    // comment
    if isSignedIn
        #comments
            #editor

block js
    script(src='/js/fetchPost.min.js')

    script.
        const postNickname = document.getElementById('post-nickname');
        const postDate = document.getElementById('post-date');
        const postContent = document.getElementById('post-content');

        fetchPost(#{postId}, null,
            data => {
                postNickname.innerText = data.nickname;
                console.log(typeof (data.date));
                postDate.innerText = data.date
                                        .replace('-', '년 ')
                                        .replace('-', '월 ')
                                        .replace('T', '일 ')
                                        .replace(':', '시 ')
                                        .replace(':', '분')
                                        .substr(0, 21)
                postContent.innerHTML = data.content;
            }, () => {
                vex.dialog.open({
                    message: '비밀번호를 입력해주세요',
                    input: `
                        <input name="password" type="password">
                    `,
                    callback: data => {
                        fetchPost(postId, data.password);
                    }
                });
            }, () => {
                vex.dialog.alert({
                        unsafeMessage: '존재하지 않는 글입니다\n전 페이지로 이동합니다',
                        callback: () => {
                        history.go(-1);
                    }
                });
            }, () => {
                vex.dialog.alert({
                    unsafeMessage: '서버 에러가 발생했습니다',
                    callback: () => {
                        vex.dialog.open({
                            message: '비밀번호를 입력해주세요',
                            input: `
                                <input name="password" type="password">
                            `,
                            callback: (data) => {
                                fetchPost(postId, data.password);
                            }
                        });
                    }
                });
            }
        );

    // comment
    if isSignedIn
        script(src='https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js')
        script.
            const quill = new Quill('#editor', {
                placeholder: '글 내용',
                theme: 'snow'
            });

extends ../layout

block css
    link(href='/css/posts.min.css' rel='stylesheet')
    link(href='https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.snow.min.css' rel='stylesheet')
    link(href='/css/comments.min.css' rel='stylesheet')

block html
    #post-information.d-flex.flex-row.justify-content-around
        .d-flex.flex-row
            i.material-icons account_box
            span#post-nickname

        .d-flex.flex-row
            i.material-icons access_time
            span#post-date

    .separating-line

    #post-content

    .separating-line

    // comment
    #comments-container.d-flex.flex-column

    if isSignedIn
        div: #editor
        div.text-center.d-flex.flex-row.align-items-center
            input#is-private-comment(type='checkbox')
            label(for='is-private-comment') 비밀댓글
            button#new-comment.submit: span 댓글 작성
            button#update-comment.submit(style='display: none;'): span 댓글 수정

append js
    script(src='/js/fetchPost.min.js')
    script(src='/js/isoDateToKoreanDate.min.js')

    script.
        const postNickname = document.getElementById('post-nickname');
        const postDate = document.getElementById('post-date');
        const postContent = document.getElementById('post-content');
        const commentsContainer = document.getElementById('comments-container');
        const postId = #{postId};

        fetchPost(postId, '');

    // comment
    if isSignedIn
        script(src='https://cdnjs.cloudflare.com/ajax/libs/quill/1.3.7/quill.min.js')
        script(src='/js/fetchNewComment.min.js')
        script(src='/js/fetchUpdateComment.min.js')
        script(src='/js/enableWaitButton.min.js')
        script(src='/js/disableWaitButton.min.js')
        script.
            const quill = new Quill('#editor', {
                placeholder: '글 내용',
                theme: 'snow'
            });

            const isPrivateComment = document.getElementById('is-private-comment');
            const newComment = document.getElementById('new-comment');
            const newCommentText = newComment.getElementsByTagName('span')[0];
            const deleteComment = document.getElementsByClassName('delete-comment');
            const updateComment = document.getElementById('update-comment');
            const updateCommentText = updateComment.getElementsByTagName('span')[0];
            let updateTarget = null;

            newComment.addEventListener('click', () => {
                enableWaitButton(newComment, newCommentText);

                fetchNewComment(() => {
                    disableWaitButton(newComment, newCommentText, '댓글 작성')
                });
            });

            updateComment.addEventListener('click', () => {
                enableWaitButton(updateComment, updateCommentText);

                fetchUpdateComment(updateTarget, () => {
                    disableWaitButton(updateComment, updateCommentText, '댓글 수정')
                });
            });

    if owner !== undefined && owner
        script(src='/js/fetchDeletePost.min.js')
        script.
            const deletePost = document.getElementById('delete-post');

            deletePost.addEventListener('click', () => {
                fetchDeletePost(postId, '');
            });

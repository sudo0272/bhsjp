extends ../layout

block css
    link(href='/css/posts.min.css' rel='stylesheet')

block html
    #post-information.d-flex.flex-row.justify-content-around
        .d-flex.flex-row
            i.material-icons account_box
            span#post-nickname

        .d-flex.flex-row
            i.material-icons access_time
            span#post-date

    #post-content

    // comment
    if isSignedIn
        #quill-toolbar
        #quill-editor

block js
    script(src='/js/fetchPost.min.js')

    script.
        const postNickname = document.getElementById('post-nickname');
        const postDate = document.getElementById('post-date');
        const postContent = document.getElementById('post-content');

        fetchPost(#{postId}, null,
            data => {
                postNickname.innerText = data.nickname;
                postDate.innerText = data.date.getFullYear() + '년 ' + data.date.getMonth() + '월 ' + data.date.getDay() + '일 ' + data.date.getHours() + '시 ' + ('0' + date.getMinutes()).slice(-2) + '분';
                postContent.innerHTML = data.content;
            }, () => {
                vex.dialog.open({
                    message: '비밀번호를 입력해주세요',
                    input: `
                        <input name="password" type="password">
                    `,
                    callback: data => {
                        fetchPost(postId, data.password);
                    }
                });
            }, () => {
                vex.dialog.alert({
                        unsafeMessage: '존재하지 않는 글입니다\n전 페이지로 이동합니다',
                        callback: () => {
                        history.go(-1);
                    }
                });
            }, () => {
                vex.dialog.alert({
                    unsafeMessage: '서버 에러가 발생했습니다',
                    callback: () => {
                        vex.dialog.open({
                            message: '비밀번호를 입력해주세요',
                            input: `
                                <input name="password" type="password">
                            `,
                            callback: (data) => {
                                fetchPost(postId, data.password);
                            }
                        });
                    }
                });
            }
        );

    // comment
    if isSignedIn
        script.
            let quill = new Quill('#quill-editor', {
                modules: {
                    toolbar: '#quill-toolbar'
                }
            });
